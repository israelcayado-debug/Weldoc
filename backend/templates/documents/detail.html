{% extends "base.html" %}

{% block content %}
  <h1>{{ item.title }}</h1>
  <p>Tipo: {{ item.type }}</p>
  <p>Estado: {{ item.status }}</p>
  <p>Proyecto: {{ item.project }}</p>
  <p>
    <a href="/ui/documents/{{ item.id }}/revisions/new/">Nueva revision</a> |
    <a href="/ui/documents/">Volver</a>
  </p>

  <h2>Revisiones</h2>
  <ul>
    {% for rev in revisions %}
      <li>
        {{ rev.revision }} - {{ rev.status }}
        {% if rev.file_path %}
          - <a href="/media/{{ rev.file_path }}">Archivo</a>
        {% endif %}
        {% if rev.status == "draft" %}
          <form method="post" action="/ui/documents/revisions/{{ rev.id }}/submit/" style="display:inline;">
            {% csrf_token %}
            <button type="submit">Enviar a revision</button>
          </form>
        {% endif %}
        {% if rev.status == "draft" or rev.status == "in_review" %}
          <form method="post" action="/ui/documents/revisions/{{ rev.id }}/approve/" style="display:inline;">
            {% csrf_token %}
            <button type="submit">Aprobar</button>
          </form>
          <form method="post" action="/ui/documents/revisions/{{ rev.id }}/reject/" style="display:inline;">
            {% csrf_token %}
            <button type="submit">Rechazar</button>
          </form>
        {% endif %}
        <form method="get" action="/ui/documents/revisions/{{ rev.id }}/approvals/new/" style="display:inline;">
          <button type="submit">Agregar aprobador</button>
        </form>
        <form method="get" action="/ui/documents/revisions/{{ rev.id }}/signatures/new/" style="display:inline;">
          <button type="submit">Firmar</button>
        </form>
      </li>
    {% empty %}
      <li>Sin revisiones.</li>
    {% endfor %}
  </ul>

  <h2>Aprobaciones</h2>
  <ul>
    {% for approval in approvals %}
      <li>
        {{ approval.document_revision.revision }} - {{ approval.approver }} - {{ approval.status }}
        {% if approval.status == "pending" %}
          <form method="post" action="/ui/documents/approvals/{{ approval.id }}/approve/" style="display:inline;">
            {% csrf_token %}
            <button type="submit">Aprobar</button>
          </form>
          <form method="post" action="/ui/documents/approvals/{{ approval.id }}/reject/" style="display:inline;">
            {% csrf_token %}
            <button type="submit">Rechazar</button>
          </form>
        {% endif %}
      </li>
    {% empty %}
      <li>Sin aprobaciones.</li>
    {% endfor %}
  </ul>

  <h2>Firmas</h2>
  <ul>
    {% for sig in signatures %}
      <li>{{ sig.document_revision.revision }} - {{ sig.signer }}</li>
    {% empty %}
      <li>Sin firmas.</li>
    {% endfor %}
  </ul>
{% endblock %}
